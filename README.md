# Ivi.ru - агрегатор фильмов

Копия сайта ivi.ru с админ-панелью с авторизацией - фронтенд-часть проекта.

# Стек

[![My Skills](https://skillicons.dev/icons?i=nextjs,ts)](https://skillicons.dev)

\+ Storybook, Jest, Cypress, Sass

# Полное описание

Проект занял у нашей команды около полутора месяцев и для многих стал первым опытом взаимодействия с бэкендерами и вообще полноценной работы в команде. Все возникающие проблемы старались решать сами, лишь по необходимости прибегая к помощи кураторов. Ниже по пунктам описываются особенности проекта и обоснования решений, принятых нами в ходе его реализации.

## 1. Выбор фреймворка

Мы обсуждали два варианта - использовать create-react-app/vite в связке с react-router или вопользоваться фреймворком NextJS. Поскольку у некоторых из нас был небольшой опыт с NextJS, а у остальных было желание с ним поработать, выбор был сделан в пользу NextJS.

## 2. Структура проекта

Изначально, пока проект был небольшим, для компонентов мы использовали просто папку components. По мере разрастания проекта стало очевидно, что нам нужна еще какая-то иерархия в этой папке. Примерно на этом этапе мы узнали про feature-sliced design, долго обсуждали, попробовать ли применить его, в это время кодовая база еще разрослась, и в итоге мы решили, что ограничимся группировкой компонентов по папкам по их назначению. Мы несколько недооценили важность планирования структуры заранее, и в дальнейших проектах старались бы определиться с этим заранее с учетом размера проекта.

## 3. Верстка

Мы старались по максимуму воспользоваться возможностями CSS(Sass)-модулями и не использовать вспомогательные решения вроде Styled Components, Bootstrap или Material UI. Исключениями стали библиотека react-select, которая была использована для быстрой кастомизации селектов и, в особенности, мультиселектов, т.к. решения на чистом CSS показались нам слишком громоздкими, а также слайдеры. Для цветов использовали переменные Sass для.

Для адаптива мы использовали кастомный хук useMediaQuery, а в случаях, когда мобильные и десктопные компоненты слишком отличались, писали отдельные компоненты для мобильной версии.

## 4. Управление состоянием

Мы планировали использовать Redux-Toolkit, но, как оказалось, во-первых, Redux вообще плохо сочетается с Next JS, а во-вторых, в подобном приложении вообще можно обойтись без менеджера состояния. Мы использовали useContext для авторизации, а остальное состояние управляется локально. Проп-дриллинга при этом в целом удалось избежать.

## 5. Storybook

Это был наш первый опыт использования Storybook, поэтому изначально у нас не было четкого понимания, что именно следует туда помещать. Сошлись на том, что туда точно подходят все кнопки и компоненты слайдеров и ограничились ими.

## 6. Интернационализация

Сначала мы сделали кастомный хук и базу переводов, и в зависимости от выбранного языка рендерили нужный текст. Затем было найдено решение с помощью фреймворка react-i18next, и интернационализация была переписана с нуля - это именно тот способ, которым рекомендуется делать интернационализацию для Next JS.

## 7. Авторизация

Для авторизации используется jwt. На ivi.ru совмещены вход и регистрация, т.е. пользователь должен лишь единожды ввести свою почту и пароль, нажать отправить, а сайт сам решает регистрировать его или входить в уже существующий аккаунт. Поэтому, поскольку логинятся пользователи чаще, чем регистрируются новые, изначально после ввода данных посылается запрос на логин. Если сервер отвечает ошибкой о несуществующем пользователе, то сразу посылается запрос на регистрацию. После входа в аккаунт с сервера приходит access token, который затем использутеся в header authorization для доступа к функциям для зарегистрированных пользователей. Кроме того, сервер сам записывает refresh token в куки для обновления access token, если тот истечет. Для запросов авторизованных пользователей создан отдельный AxiosInstance, на котором заданы interceptors с добавлением токенов. Для того, чтобы в самом приложении узнавать, является ли пользователь авторизованным (а также админом) используется Context с соответствующими переменными.

## 8. Тестирование

В первую очередь покрывали тестами те комопненты, где есть интерактив или различие между десктопной и мобильной версией (хедер, футер), а также покрыли тестами все вспомогательные функции, для которых это имело смысл. Ближе к завершению проекта также внедрили cypress для e2e-тестирования.
